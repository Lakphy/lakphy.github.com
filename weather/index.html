<!DOCTYPE html>
<html>

<head>
    <title>Lakphy的天气预报</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.5, maximum-scale=2.0, user-scalable=no" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="auther" content="Lakphy">
    <meta name="description=" content="Lakphy">
    <meta name="Keywords" content="Lakphy">
    <link rel="stylesheet" href="./css/main.css">
    <link rel="stylesheet" href="css/mdui.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <script src="./js/echarts.min.js"></script>
</head>

<body>
    <!--body-->
    <div id="bg">
        <!--background-->
    </div>
    <div class="mdui-container">
        <div class="mdui-toolbar mdui-color-theme" id="topbar">
            <a href="./index.html" class="mdui-btn mdui-btn-icon"><i class="fa fa-cloud fa-lg mdui-icon material-icons" aria-hidden="true"></i></a>
            <span class="mdui-typo-title mdui-hidden-xs" id="province"></span>
            <span class="mdui-typo-title" id="city">Lakphy的天气预报</span>
            <div class="mdui-toolbar-spacer"></div>
            <a href="./searcher/index.html" class="mdui-btn mdui-btn-icon"><i class="fa fa-search fa-lg mdui-icon material-icons" aria-hidden="true"></i></a>
        </div>
        <br>
        <div class="mdui-row-sm-2 mdui-row-xs-1">
            <!--左上-->
            <div class="mdui-col" style="margin-top: 18vh;margin-bottom: 5vh;">
                <!--温度-->
                <div class="temperature"><span style="font-size: 8vh;"><b>°C</b></span></div>
                <!--天气-->
                <div class="weather"></div>
                <div class="mdui-chip" id="xiaoTieShi" style="display: none;"><span class="mdui-chip-title" style="float:left">小贴士</span></div><br><br>
                <div class="ganmao"></div>
            </div>
            <!--右上-->
            <div class="mdui-col" id="detail">
                <a href="./index.html" class="mdui-btn mdui-btn-icon"><i class="fa fa-refresh fa-lg mdui-icon material-icons" aria-hidden="true"></i></a>
                <span class="mdui-typo-title" id="date"></span><br>
                <a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="fa fa-flag fa-lg mdui-icon material-icons" aria-hidden="true"></i></a>
                <span class="mdui-typo-title" id="wind"></span>
                <div class="mdui-table-fluid cast-board mdui-shadow-0 mdui-text-color-white">
                    <table class="mdui-table cast-table mdui-text-color-white" style="color:white">
                        <thead>
                            <tr>
                                <th>未来三天</th>
                                <th>天气</th>
                                <th>温度</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="mdui-collapse mdui-text-color-black mdui-m-a-2 mdui-text-center mdui-text-color-white" mdui-collapse>
                        <div class="mdui-collapse-item">
                            <div class="mdui-collapse-item-header">
                                <p><a href="javascript:;" style="color: white;"><i class="fa fa-bar-chart fa-lg" aria-hidden="true">&nbsp;</i>更多</a></p>
                            </div>
                            <div class="mdui-collapse-item-body">
                                <div class="mdui-text-color-white" id="e-chart" style="color:white;width: 100%;height:300px;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--JS-->
    <script src="js/jquery-3.5.1.min.js"></script>
    <script src="js/main.js"></script>
    <script src="js/mdui.min.js"></script>
    <script>
        function dark() {
            document.getElementById("bg").style.background = "linear-gradient(#0e2769, #3670b0)";
        }

        function day() {
            document.getElementById("bg").style.background = "linear-gradient(#2677d2, #639ee0)";
        }

        function geter() {
            var city, province, adcode;
            var weatherGaode, weather;
            $.get(
                'https://restapi.amap.com/v3/ip?key=07ea516d52e6cbc1bed936289d8061c9',
                function(html) {
                    city = html.city;
                    document.getElementById("city").innerHTML = city + "&nbsp;<i class='fa fa-map-marker' aria-hidden='true'></i>";
                    province = html.province;
                    document.getElementById("province").innerHTML = province;
                    adcode = html.adcode;
                    console.log(html);
                    $.get(
                        'https://restapi.amap.com/v3/weather/weatherInfo?city=' + adcode + '&key=07ea516d52e6cbc1bed936289d8061c9&extensions=all',
                        function(html) {
                            console.log(html);
                            weatherGaode = html;
                            document.getElementsByClassName("weather")[0].innerHTML = weatherGaode.forecasts[0].casts[0].dayweather;
                            document.getElementsByClassName("temperature")[0].innerHTML = "" + weatherGaode.forecasts[0].casts[0].daytemp + "<span style='font-size: 8vh;''><b>°C</b></span>";
                            document.getElementById("wind").innerHTML = weatherGaode.forecasts[0].casts[0].daywind + "风" + weatherGaode.forecasts[0].casts[0].daypower + "级";
                            document.getElementById("date").innerHTML = "" + weatherGaode.forecasts[0].reporttime + " 更新";
                            for (i = 3; i < 12; i += 3) {
                                document.getElementsByTagName("td")[i - 3].innerHTML = "" + (weatherGaode.forecasts[0].casts[i / 3].date.split("-")[1] * 1) + "月" + (weatherGaode.forecasts[0].casts[i / 3].date.split("-")[2] * 1) + "日";
                                if (weatherGaode.forecasts[0].casts[i / 3].nightweather == weatherGaode.forecasts[0].casts[i / 3].dayweather) document.getElementsByTagName("td")[i - 2].innerHTML = weatherGaode.forecasts[0].casts[i / 3].dayweather;
                                else {
                                    document.getElementsByTagName("td")[i - 2].innerHTML = weatherGaode.forecasts[0].casts[i / 3].dayweather + "/" + weatherGaode.forecasts[0].casts[i / 3].nightweather;
                                }
                                document.getElementsByTagName("td")[i - 1].innerHTML = weatherGaode.forecasts[0].casts[i / 3].nighttemp + "~" + weatherGaode.forecasts[0].casts[i / 3].daytemp + "°C";
                            }
                        }
                    );
                    $.get(
                        'http://wthrcdn.etouch.cn/weather_mini?city=' + city,
                        function(html) {
                            weather = JSON.parse(html);
                            console.log(weather);
                            document.getElementsByClassName("ganmao")[0].innerHTML = weather.data.ganmao;
                            document.getElementById("xiaoTieShi").style.display = "inline-block";
                            var myChart = echarts.init(document.getElementById('e-chart'));
                            var option = {
                                title: {
                                    textStyle: {
                                        fontSize: 18, //字体大小
                                        color: '#ffffff' //字体颜色
                                    },
                                    text: '最近天气'
                                },
                                tooltip: {
                                    trigger: 'axis',
                                    //formatter: '{b0}<br>{a0}: {c0}℃<br>{a1}: {c1}℃',
                                    formatter: function(params, ticket, callback) {
                                        console.log(params);
                                        if (params[0].dataIndex == 0) {
                                            res = weather.data.yesterday.date + "<br>天气：" + weather.data.yesterday.type + "<br>" + weather.data.yesterday.fx + weather.data.yesterday.fl.split("[")[2].split("]")[0] + "<br>" + weather.data.yesterday.high + "<br>" + weather.data.yesterday.low;
                                        } else {
                                            res = weather.data.forecast[params[0].dataIndex - 1].date + "<br>天气：" + weather.data.forecast[params[0].dataIndex - 1].type + "<br>" + weather.data.forecast[params[0].dataIndex - 1].fengxiang + weather.data.forecast[params[0].dataIndex - 1].fengli.split("[")[2].split("]")[0] + "<br>" + weather.data.forecast[params[0].dataIndex - 1].high + "<br>" + weather.data.forecast[params[0].dataIndex - 1].low;
                                        }
                                        return res;
                                    }
                                },
                                legend: {
                                    textStyle: {
                                        color: '#ffffff' //字体颜色
                                    },
                                    data: ['低温', '高温']
                                },
                                grid: {
                                    left: '3%',
                                    right: '7%',
                                    bottom: '3%',
                                    containLabel: true
                                },
                                toolbox: {
                                    feature: {
                                        //saveAsImage: {}
                                    }
                                },
                                xAxis: {
                                    type: 'category',
                                    boundaryGap: false,
                                    data: ['昨日', '今日', '明日', weather.data.forecast[2].date.split("日")[0] + "日", weather.data.forecast[3].date.split("日")[0] + "日", weather.data.forecast[4].date.split("日")[0] + "日"],
                                    axisLabel: {
                                        show: true,
                                        textStyle: {
                                            color: '#fff'
                                        }
                                    }
                                },
                                yAxis: {
                                    type: 'value',
                                    axisLabel: {
                                        show: true,
                                        textStyle: {
                                            color: '#fff'
                                        }
                                    }
                                },
                                series: [{
                                    name: '低温',
                                    type: 'line',
                                    stack: '温度',
                                    data: [weather.data.yesterday.low.split(" ")[1].split("℃")[0] * 1, weather.data.forecast[0].low.split(" ")[1].split("℃")[0] * 1, weather.data.forecast[1].low.split(" ")[1].split("℃")[0] * 1, weather.data.forecast[2].low.split(" ")[1].split("℃")[0] * 1, weather.data.forecast[3].low.split(" ")[1].split("℃")[0] * 1, weather.data.forecast[4].low.split(" ")[1].split("℃")[0] * 1]
                                }, {
                                    name: '高温',
                                    type: 'line',
                                    stack: '总量',
                                    data: [weather.data.yesterday.high.split(" ")[1].split("℃")[0] * 1, weather.data.forecast[0].high.split(" ")[1].split("℃")[0] * 1, weather.data.forecast[1].high.split(" ")[1].split("℃")[0] * 1, weather.data.forecast[2].high.split(" ")[1].split("℃")[0] * 1, weather.data.forecast[3].high.split(" ")[1].split("℃")[0] * 1, weather.data.forecast[4].high.split(" ")[1].split("℃")[0] * 1]
                                }]
                            };
                            myChart.setOption(option);
                        }
                    );
                }
            );
        }

        function geter2(cityinfo) {
            var city, province, adcode;
            var weatherGaode, weather;
            $.get(
                'https://restapi.amap.com/v3/geocode/geo?address=' + cityinfo + '&key=07ea516d52e6cbc1bed936289d8061c9',
                function(html) {
                    adcode = html.geocodes[0].adcode;
                    console.log(html);
                    city = html.geocodes[0].district;
                    document.getElementById("city").innerHTML = city;
                    province = html.geocodes[0].city;
                    document.getElementById("province").innerHTML = province;

                    $.get(
                        'https://restapi.amap.com/v3/weather/weatherInfo?city=' + adcode + '&key=07ea516d52e6cbc1bed936289d8061c9&extensions=all',
                        function(html) {
                            console.log(html);
                            weatherGaode = html;
                            document.getElementsByClassName("weather")[0].innerHTML = weatherGaode.forecasts[0].casts[0].dayweather;
                            document.getElementsByClassName("temperature")[0].innerHTML = "" + weatherGaode.forecasts[0].casts[0].daytemp + "<span style='font-size: 8vh;''><b>°C</b></span>";
                            document.getElementById("wind").innerHTML = weatherGaode.forecasts[0].casts[0].daywind + "风" + weatherGaode.forecasts[0].casts[0].daypower + "级";
                            document.getElementById("date").innerHTML = "" + weatherGaode.forecasts[0].reporttime + " 更新";
                            if (weatherGaode.forecasts[0].reporttime.split(" ")[1].split(":")[0] >= 19 || weatherGaode.forecasts[0].reporttime.split(" ")[1].split(":")[0] <= 6) dark();
                            for (i = 3; i < 12; i += 3) {
                                document.getElementsByTagName("td")[i - 3].innerHTML = "" + (weatherGaode.forecasts[0].casts[i / 3].date.split("-")[1] * 1) + "月" + (weatherGaode.forecasts[0].casts[i / 3].date.split("-")[2] * 1) + "日";
                                if (weatherGaode.forecasts[0].casts[i / 3].nightweather == weatherGaode.forecasts[0].casts[i / 3].dayweather) document.getElementsByTagName("td")[i - 2].innerHTML = weatherGaode.forecasts[0].casts[i / 3].dayweather;
                                else {
                                    document.getElementsByTagName("td")[i - 2].innerHTML = weatherGaode.forecasts[0].casts[i / 3].dayweather + "/" + weatherGaode.forecasts[0].casts[i / 3].nightweather;
                                }
                                document.getElementsByTagName("td")[i - 1].innerHTML = weatherGaode.forecasts[0].casts[i / 3].nighttemp + "~" + weatherGaode.forecasts[0].casts[i / 3].daytemp + "°C";
                            }

                            $.get(
                                'http://wthrcdn.etouch.cn/weather_mini?city=' + document.getElementById("province").innerHTML,
                                function(html) {
                                    weather = JSON.parse(html);
                                    console.log(weather);
                                    document.getElementsByClassName("ganmao")[0].innerHTML = weather.data.ganmao;
                                    document.getElementById("xiaoTieShi").style.display = "inline-block";
                                    var myChart = echarts.init(document.getElementById('e-chart'));
                                    var option = {
                                        title: {
                                            textStyle: {
                                                fontSize: 18, //字体大小
                                                color: '#ffffff' //字体颜色
                                            },
                                            text: '最近天气'
                                        },
                                        tooltip: {
                                            trigger: 'axis',
                                            //formatter: '{b0}<br>{a0}: {c0}℃<br>{a1}: {c1}℃',
                                            formatter: function(params, ticket, callback) {
                                                console.log(params);
                                                if (params[0].dataIndex == 0) {
                                                    res = weather.data.yesterday.date + "<br>天气：" + weather.data.yesterday.type + "<br>" + weather.data.yesterday.fx + weather.data.yesterday.fl.split("[")[2].split("]")[0] + "<br>" + weather.data.yesterday.high + "<br>" + weather.data.yesterday.low;
                                                } else {
                                                    res = weather.data.forecast[params[0].dataIndex - 1].date + "<br>天气：" + weather.data.forecast[params[0].dataIndex - 1].type + "<br>" + weather.data.forecast[params[0].dataIndex - 1].fengxiang + weather.data.forecast[params[0].dataIndex - 1].fengli.split("[")[2].split("]")[0] + "<br>" + weather.data.forecast[params[0].dataIndex - 1].high + "<br>" + weather.data.forecast[params[0].dataIndex - 1].low;
                                                }
                                                return res;
                                            }
                                        },
                                        legend: {
                                            textStyle: {
                                                color: '#ffffff' //字体颜色
                                            },
                                            data: ['低温', '高温']
                                        },
                                        grid: {
                                            left: '3%',
                                            right: '7%',
                                            bottom: '3%',
                                            containLabel: true
                                        },
                                        toolbox: {
                                            feature: {
                                                //saveAsImage: {}
                                            }
                                        },
                                        xAxis: {
                                            type: 'category',
                                            boundaryGap: false,
                                            data: ['昨日', '今日', '明日', weather.data.forecast[2].date.split("日")[0] + "日", weather.data.forecast[3].date.split("日")[0] + "日", weather.data.forecast[4].date.split("日")[0] + "日"],
                                            axisLabel: {
                                                show: true,
                                                textStyle: {
                                                    color: '#fff'
                                                }
                                            }
                                        },
                                        yAxis: {
                                            type: 'value',
                                            axisLabel: {
                                                show: true,
                                                textStyle: {
                                                    color: '#fff'
                                                }
                                            }
                                        },
                                        series: [{
                                            name: '低温',
                                            type: 'line',
                                            stack: '温度',
                                            data: [weather.data.yesterday.low.split(" ")[1].split("℃")[0] * 1, weather.data.forecast[0].low.split(" ")[1].split("℃")[0] * 1, weather.data.forecast[1].low.split(" ")[1].split("℃")[0] * 1, weather.data.forecast[2].low.split(" ")[1].split("℃")[0] * 1, weather.data.forecast[3].low.split(" ")[1].split("℃")[0] * 1, weather.data.forecast[4].low.split(" ")[1].split("℃")[0] * 1]
                                        }, {
                                            name: '高温',
                                            type: 'line',
                                            stack: '总量',
                                            data: [weather.data.yesterday.high.split(" ")[1].split("℃")[0] * 1, weather.data.forecast[0].high.split(" ")[1].split("℃")[0] * 1, weather.data.forecast[1].high.split(" ")[1].split("℃")[0] * 1, weather.data.forecast[2].high.split(" ")[1].split("℃")[0] * 1, weather.data.forecast[3].high.split(" ")[1].split("℃")[0] * 1, weather.data.forecast[4].high.split(" ")[1].split("℃")[0] * 1]
                                        }]
                                    };
                                    myChart.setOption(option);
                                }
                            );
                        }
                    );
                }
            );
        }
        if (location.href.split("?").length == 2) {
            geter2(location.href.split("?")[1].split("=")[1]);
        } else {
            geter();
        }
    </script>
</body>

</html>